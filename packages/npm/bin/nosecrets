#!/usr/bin/env node
const { platform, arch } = process;
const { spawnSync } = require('child_process');

const PLATFORMS = {
  win32: {
    x64: '@casoon/nosecrets-win32-x64/nosecrets.exe',
  },
  darwin: {
    x64: '@casoon/nosecrets-darwin-x64/nosecrets',
    arm64: '@casoon/nosecrets-darwin-arm64/nosecrets',
  },
  linux: {
    x64: '@casoon/nosecrets-linux-x64/nosecrets',
    arm64: '@casoon/nosecrets-linux-arm64/nosecrets',
  },
};

const binPath = PLATFORMS?.[platform]?.[arch];

if (binPath) {
  const result = spawnSync(
    require.resolve(binPath),
    process.argv.slice(2),
    { shell: false, stdio: 'inherit' }
  );

  if (result.error) {
    throw result.error;
  }

  process.exitCode = result.status;
} else {
  console.error(
    'The nosecrets CLI package does not ship with prebuilt binaries for your platform (' +
    platform + '/' + arch + ').'
  );
  process.exitCode = 1;
}
